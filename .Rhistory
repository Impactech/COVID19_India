dc_i <- dc$dc_i
do_i <- build_official_data()
d_i_wide <- rbind(do_i, dc_i)
d_i_long <- d_i_wide %>% pivot_longer(
-c(StateUt, Date, Source),
values_to = 'Cumulative',
names_to = 'Status')
View(d_i_long)
d_i_long_total <- d_i_long %>% filter(Status = 'Total')
d_i_long_total <- d_i_long %>% filter(Status == 'Total')
View(d_i_long_total)
p <- ggplot(data = d_i_long_total, aes(x = Date, y = Cumulative, fill = StateUt)) +
geom_path() %>%
facet_wrap(~Source)
print(p)
View(d_i_long)
summary(d_i_long_total)
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
View(d_i_long_total)
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
View(d_i_long_total)
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
d_i_long_total <- d_i_long %>% filter(Status == 'Total') %>% filter(Date == max(Date))
View(d_i_long_total)
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
d_i_long_total <- d_i_long %>%
filter(Status == 'Total') %>%
filter(Date == max(Date)) %>%
filter(Cumulative < 5)
p <- ggplot(data = d_i_long_total, aes(x = reorder( StateUt, Cumulative ), y = Cumulative, color = StateUt, fill = StateUt)) +
geom_bar(position = 'stack', stat = 'identity') +
facet_wrap(~Source, ncol=1) + theme_minimal() +
# scale_y_continuous(trans = 'log2') +
theme(
legend.position = 'off',
axis.text.x = element_text(angle = 45, hjust = 1)
)
print(p)
d_i_long_total <- d_i_long %>%
filter(Status == 'Total') %>%
filter(Date == max(Date)) %>%
filter(Cumulative > 5)
p <- ggplot(data = d_i_long_total, aes(x = reorder( StateUt, Cumulative ), y = Cumulative, color = StateUt, fill = StateUt)) +
geom_bar(position = 'stack', stat = 'identity') +
facet_wrap(~Source, ncol=1) + theme_minimal() +
# scale_y_continuous(trans = 'log2') +
theme(
legend.position = 'off',
axis.text.x = element_text(angle = 45, hjust = 1)
)
print(p)
d_i_long_total$StateUt[d_i_long_total$StateUt == "Telentana"] <- "Telangana"
p <- ggplot(data = d_i_long_total, aes(x = reorder( StateUt, Cumulative ), y = Cumulative, color = StateUt, fill = StateUt)) +
geom_bar(position = 'stack', stat = 'identity') +
facet_wrap(~Source, ncol=1) + theme_minimal() +
# scale_y_continuous(trans = 'log2') +
theme(
legend.position = 'off',
axis.text.x = element_text(angle = 45, hjust = 1)
)
print(p)
d_i_long_total <- d_i_long %>%
filter(Status == 'Total') %>%
filter(Date == max(Date)) %>%
filter(Cumulative > 5)
d_i_long_total$StateUt[d_i_long_total$StateUt == "Telentana"] <- "Telangana"
d_i_long_total$StateUt[d_i_long_total$StateUt == "Telengana"] <- "Telangana"
p <- ggplot(data = d_i_long_total, aes(x = reorder( StateUt, Cumulative ), y = Cumulative, color = StateUt, fill = StateUt)) +
geom_bar(position = 'stack', stat = 'identity') +
facet_wrap(~Source, ncol=1) + theme_minimal() +
# scale_y_continuous(trans = 'log2') +
theme(
legend.position = 'off',
axis.text.x = element_text(angle = 45, hjust = 1)
)
print(p)
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
d_i_long_total <- d_i_long %>%
filter(Status == 'Total') %>%
filter(Date == max(Date)) %>%
filter(Cumulative > 5) %>%
filter(StateUt == 'unassigned')
d_i_long_total$StateUt[d_i_long_total$StateUt == "Telengana"] <- "Telangana"
p <- ggplot(data = d_i_long_total, aes(x = reorder( StateUt, Cumulative ), y = Cumulative, color = StateUt, fill = StateUt)) +
geom_bar(position = 'stack', stat = 'identity') +
facet_wrap(~Source, ncol=1) + theme_minimal() +
# scale_y_continuous(trans = 'log2') +
theme(
legend.position = 'off',
axis.text.x = element_text(angle = 45, hjust = 1)
)
print(p)
d_i_long_total <- d_i_long %>%
filter(Status == 'Total') %>%
filter(Date == max(Date)) %>%
filter(Cumulative > 5) %>%
filter(!(StateUt == 'unassigned'))
d_i_long_total$StateUt[d_i_long_total$StateUt == "Telengana"] <- "Telangana"
p <- ggplot(data = d_i_long_total, aes(x = reorder( StateUt, Cumulative ), y = Cumulative, color = StateUt, fill = StateUt)) +
geom_bar(position = 'stack', stat = 'identity') +
facet_wrap(~Source, ncol=1) + theme_minimal() +
# scale_y_continuous(trans = 'log2') +
theme(
legend.position = 'off',
axis.text.x = element_text(angle = 45, hjust = 1)
)
print(p)
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
Sys.Date
Sys.Date()
Sys.time()
source('~/work/covid19/COVID19_India/IndiaTimeseries_v2.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v2.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v2.R')
View(data_total)
View(labels)
source('~/work/covid19/COVID19_India/IndiaTimeseries_v2.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v2.R')
View(data)
View(data_state)
source('~/work/covid19/COVID19_India/IndiaTimeseries_v2.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
animate <- T
rebuild_dataframe <- T
yesterday <- Sys.Date()-1
### From the notebook
dc <- build_crowd_data()
dc_i <- dc$dc_i
do_i <- build_official_data()
d_i_wide <- rbind(do_i, dc_i)
# d_i_long <- d_i_wide %>% pivot_longer(
#   -c(StateUt, Date, Source),
#   values_to = 'Cumulative',
#   names_to = 'Status')
## Statewise Data
data_panindia_total<- d_i_wide %>%
group_by(Date, Source) %>%
summarize(Total = sum(Total)) %>%
mutate(StateUt = "India Total") %>%
ungroup()
data_states_total <- d_i_wide %>%
select(StateUt, Source, Date, Total) %>%
ungroup()
data_i_total <- rbind(data_panindia_total, data_states_total)
###
data <- data_i_total %>%
mutate(Day = as.integer(strftime(Date, format = "%j")) ) %>%
group_by(StateUt) %>%
mutate( DaysSince0 = Day - min(Day)  ) %>%
mutate( MaxDays = max(DaysSince0) ) %>%
ungroup() %>%
filter(Total > 2) %>%
mutate(label =  paste(Total, StateUt, sep=" | "))
y_max <- max(data$Total)
x_max <- max(data$DaysSince0)
x_label <- x_max + 5
labels <- data %>%
filter(Date == max(Date)) %>%
arrange( Total ) %>%
mutate(yend = (y_max/n())*row_number()) %>%
# mutate( yend = ( 2^(  (log2(y_max)/(n()) )*row_number()  )) ) %>%
select(StateUt, yend)
data <- left_join(data, labels, by = c("StateUt") )
View(data)
data <- data_i_total %>%
mutate(Day = as.integer(strftime(Date, format = "%j")) ) %>%
group_by(StateUt) %>%
mutate( DaysSince0 = Day - min(Day)  ) %>%
mutate( MaxDays = max(DaysSince0) ) %>%
ungroup() %>%
filter(Total > 2) %>%
mutate(label =  paste(Total, StateUt, sep=" | "))
data_i_total <- rbind(data_panindia_total, data_states_total)
### From the notebook
dc <- build_crowd_data()
dc_i <- dc$dc_i
do_i <- build_official_data()
d_i_wide <- rbind(do_i, dc_i)
# d_i_long <- d_i_wide %>% pivot_longer(
#   -c(StateUt, Date, Source),
#   values_to = 'Cumulative',
#   names_to = 'Status')
## Statewise Data
data_panindia_total<- d_i_wide %>%
group_by(Date, Source) %>%
summarize(Total = sum(Total)) %>%
mutate(StateUt = "India Total") %>%
ungroup()
data_states_total <- d_i_wide %>%
select(StateUt, Source, Date, Total) %>%
ungroup()
data_i_total <- rbind(data_panindia_total, data_states_total)
###
### From the notebook
dc <- build_crowd_data()
dc_i <- dc$dc_i
do_i <- build_official_data()
d_i_wide <- rbind(do_i, dc_i)
# d_i_long <- d_i_wide %>% pivot_longer(
#   -c(StateUt, Date, Source),
#   values_to = 'Cumulative',
#   names_to = 'Status')
## Statewise Data
data_panindia_total<- d_i_wide %>%
group_by(Date, Source) %>%
summarize(Total = sum(Total)) %>%
mutate(StateUt = "India Total") %>%
ungroup()
data_states_total <- d_i_wide %>%
select(StateUt, Source, Date, Total) %>%
ungroup()
data_i_total <- rbind(data_panindia_total, data_states_total)
###
source('./source_crowd_data.r')
dc <- build_crowd_data()
dc_i <- dc$dc_i
do_i <- build_official_data()
d_i_wide <- rbind(do_i, dc_i)
### From the notebook
if (T)  {
dc <- build_crowd_data()
dc_i <- dc$dc_i
do_i <- build_official_data()
d_i_wide <- rbind(do_i, dc_i)
}
# d_i_long <- d_i_wide %>% pivot_longer(
#   -c(StateUt, Date, Source),
#   values_to = 'Cumulative',
#   names_to = 'Status')
## Statewise Data
data_panindia_total<- d_i_wide %>%
group_by(Date, Source) %>%
summarize(Total = sum(Total)) %>%
mutate(StateUt = "India Total") %>%
ungroup()
data_states_total <- d_i_wide %>%
select(StateUt, Source, Date, Total) %>%
ungroup()
data_i_total <- rbind(data_panindia_total, data_states_total)
dc <- build_crowd_data()
dc_i <- dc$dc_i
do_i <- build_official_data()
d_i_wide <- rbind(do_i, dc_i)
source('./source_crowd_data.r')
source('./source_official_data.r')
if (T)  {
dc <- build_crowd_data()
dc_i <- dc$dc_i
do_i <- build_official_data()
d_i_wide <- rbind(do_i, dc_i)
}
data_panindia_total<- d_i_wide %>%
group_by(Date, Source) %>%
summarize(Total = sum(Total)) %>%
mutate(StateUt = "India Total") %>%
ungroup()
data_states_total <- d_i_wide %>%
select(StateUt, Source, Date, Total) %>%
ungroup()
data_i_total <- rbind(data_panindia_total, data_states_total)
data_anim <- data_i_total %>%
mutate(Day = as.integer(strftime(Date, format = "%j")) ) %>%
group_by(StateUt) %>%
mutate( DaysSince0 = Day - min(Day)  ) %>%
mutate( MaxDays = max(DaysSince0) ) %>%
ungroup() %>%
filter(Total > 2) %>%
mutate(label =  paste(Total, StateUt, sep=" | "))
y_max <- max(data_anim$Total)
x_max <- max(data_anim$DaysSince0)
x_label <- x_max + 5
labels <- data_anim %>%
filter(Date == max(Date)) %>%
arrange( Total ) %>%
mutate(yend = (y_max/n())*row_number()) %>%
# mutate( yend = ( 2^(  (log2(y_max)/(n()) )*row_number()  )) ) %>%
select(StateUt, yend)
View(labels)
View(data_anim)
data <- left_join(data_anim, labels, by = c("StateUt") )
View(data)
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
View(data_anim)
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
View(data_anim)
p <- ggplot(data = data_anim, aes(x=StateUt, y=DaysSince0, fill = StateUt, size = Total^(0.3) ))  +
geom_point(shape = 21, color = 'white') +
geom_line(size = 0.5, alpha=0.6)
p <- p +
theme_minimal() +
# theme(
#   axis.text=element_text(size=10, color = "darkgrey"),
#   axis.title=element_text(size=12)
# ) +
theme( legend.position = 'off', axis.text.x = element_text(angle = 45) ) +
# theme(plot.title = element_text(size = 12, hjust = 0.5) ) +
# theme(plot.margin = margin(15, 160, 15, 10)) +
coord_cartesian(clip = 'off')  +
scale_color_viridis_d(option="inferno", end = 0.9) +
scale_fill_viridis_d(option="inferno", end = 0.9) +
xlab("Number of day since first report") +
ylab("Number of cases (Cumulative)")
print(p)
library(tidyverse)
library(lubridate)
library(viridis)
library(gganimate)
library(animation)
library(gifski)
library(janitor)
source('./source_crowd_data.r')
source('./source_official_data.r')
options(
gganimate.nframes = 100,
gganimate.fps=10
)
### From the notebook
if (T)  {
dc <- build_crowd_data()
dc_i <- dc$dc_i
do_i <- build_official_data()
d_i_wide <- rbind(do_i, dc_i)
}
# d_i_long <- d_i_wide %>% pivot_longer(
#   -c(StateUt, Date, Source),
#   values_to = 'Cumulative',
#   names_to = 'Status')
## Statewise Data
data_panindia_total<- d_i_wide %>%
group_by(Date, Source) %>%
summarize(Total = sum(Total)) %>%
mutate(StateUt = "India Total") %>%
ungroup()
data_states_total <- d_i_wide %>%
select(StateUt, Source, Date, Total) %>%
ungroup()
data_i_total <- rbind(data_panindia_total, data_states_total)
###
### Adding labels to dataframe
data_anim <- data_i_total %>%
filter(Source == 'Crowd Source') %>%
mutate(Day = as.integer(strftime(Date, format = "%j")) ) %>%
group_by(StateUt) %>%
mutate( DaysSince0 = Day - min(Day)  ) %>%
mutate( MaxDays = max(DaysSince0) ) %>%
ungroup() %>%
filter(Total > 2) %>%
mutate(label =  paste(Total, StateUt, sep=" | "))
#
# y_max <- max(data_anim$Total)
# x_max <- max(data_anim$DaysSince0)
# x_label <- x_max + 5
#
# labels <- data_anim %>%
#   filter(Date == max(Date)) %>%
#   arrange( Total ) %>%
#   mutate(yend = (y_max/n())*row_number()) %>%
#   # mutate( yend = ( 2^(  (log2(y_max)/(n()) )*row_number()  )) ) %>%
#   select(StateUt, yend)
# data_anim2 <- left_join(data_anim, labels, by = c("StateUt") )
p <- ggplot(data = data_anim, aes(x=StateUt, y=DaysSince0, fill = StateUt, size = Total^(0.3) ))  +
geom_point(shape = 21, color = 'white') +
geom_line(size = 0.5, alpha=0.6)  # +
# geom_label(
#   aes(x=x_label, y = yend, label = label, fill=StateUt),
#   color='white', fontface = "bold",
#   hjust = 0, size=3) +
# geom_segment(aes(xend = x_label, yend = yend, color = StateUt), linetype = "11", size=0.4, alpha=0.5)
p <- p +
theme_minimal() +
# theme(
#   axis.text=element_text(size=10, color = "darkgrey"),
#   axis.title=element_text(size=12)
# ) +
theme( legend.position = 'off', axis.text.x = element_text(angle = 45) ) +
# theme(plot.title = element_text(size = 12, hjust = 0.5) ) +
# theme(plot.margin = margin(15, 160, 15, 10)) +
coord_cartesian(clip = 'off')  +
scale_color_viridis_d(option="inferno", end = 0.9) +
scale_fill_viridis_d(option="inferno", end = 0.9) +
xlab("Number of day since first report") +
ylab("Number of cases (Cumulative)")  # +
# scale_y_continuous(trans = 'log2') +
# scale_radius(
#   range = c(1, 15),
#   trans = "identity",
#   guide = "legend"
# )
print(p)
p <- p +
transition_time(Date) + ease_aes('cubic-in-out') #+
#transition_reveal(Date)
animate(
p,
renderer=gifski_renderer( loop = T ), # render gif
# renderer=av_renderer(), # render video
res=150,
height = 720,
width = 1280
)
anim_save(paste("output", ".gif", sep="" ), animation = last_animation())
animate(
p,
renderer=gifski_renderer( loop = T ),
res=150,
height = 720,
width = 1280
)
anim_save(paste("output", ".gif", sep="" ), animation = last_animation())
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
View(data_anim)
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
View(data_anim)
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
?geom_label
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
View(data_anim)
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
?element_text
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseries_v3.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaStateWise.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
source('~/work/covid19/COVID19_India/IndiaTimeseriesAnimation.R')
ani
ani.options()
ani.options('end_pause')
ani.options('cm')
options(gganimate.end_pause)
