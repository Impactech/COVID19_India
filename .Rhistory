mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date), date_prev = lag(date) )
View(d_official)
data_total_official <- d_official %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0))
View(d_official)
View(d_official)
data_total_official <- d_official %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date), date_prev = lag(date) )
View(data_total_official)
data_total_official <- d_official %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) )
?as.integer()
?difftime()
data_total_official <- d_official %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
data_total_official <- d_official %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
filter(date > ymd('2020-03-03')	) %>%
mutate( rate1 = round((Total - total_prev)*100/(date_current_prev*total_prev) ), rate2 = round((total_next - total_prev)*100/((date_next_prev)*Total)) ) %>%
ungroup()
data_total_official <- d_official %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
filter(date > ymd('2020-03-03')	)
data_total_official <- d_official %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
View(data_total_official)
View(data_total_official)
View(data_total_official)
data_total_official <- d_official %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
mutate( rate1 = round((Total - total_prev)*100/(date_current_prev*total_prev) ), rate2 = round((total_next - total_prev)*100/((date_next_prev)*Total)) ) %>%
ungroup()
data_total_official <- d_official %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") )
View(d_official)
data_total_official <- d_official %>% mutate(date = ymd(date)) %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
mutate( rate1 = round((Total - total_prev)*100/(date_current_prev*total_prev) ), rate2 = round((total_next - total_prev)*100/((date_next_prev)*Total)) ) %>%
ungroup()
View(d_official)
data_total_official <- d_official %>% mutate(date = mdy(date)) %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
mutate( rate1 = round((Total - total_prev)*100/(date_current_prev*total_prev) ), rate2 = round((total_next - total_prev)*100/((date_next_prev)*Total)) ) %>%
ungroup()
data_total_official <- d_official %>% mutate(date = mdy(date)) %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") )
View(data_total_official)
?difftime
data_total_official <- d_official %>% mutate(date = mdy(date)) %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
mutate( rate1 = round((Total - total_prev)*100/(date_current_prev*total_prev) ), rate2 = round((total_next - total_prev)*100/((date_next_prev)*Total)) ) %>%
ungroup()
as.integer(NA)
data_total_official <- d_official %>% mutate(date = mdy(date)) %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
mutate( rate1 = round((Total - total_prev)*100/(as.integer(date_current_prev)*total_prev) ), rate2 = round((total_next - total_prev)*100/(as.integer(date_next_prev)*Total)) ) %>%
ungroup()
View(data_total_official)
data_rate_official <- data_total_official %>% select(date, rate1, rate2)
View(data_rate_official)
View(data_rate)
data_total_official <- d_official %>% mutate(date = mdy(date)) %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
mutate( rate1 = round((Total - total_prev)*100/(as.integer(date_current_prev)*total_prev) ), rate2 = round((total_next - total_prev)*100/(as.integer(date_next_prev)*Total)) ) %>%
ungroup() %>% filter(date > ymd('2020-03-03')	)
data_rate <- data_total %>% select(date, rate1, rate2)
data_rate_official <- data_total_official %>% select(date, rate1, rate2)
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
View(data_rate)
View(data_rate_official)
data_rate <- rbind(data_rate, data_rate_official)
View(data_rate)
data_rate <- data_total %>% select(date, rate1, rate2) %>% mutate(source = "Crowd")
data_rate_official <- data_total_official %>% select(date, rate1, rate2) %>% mutate(source = "Official")
data_rate <- rbind(data_rate, data_rate_official)
View(data_rate)
?geom_smooth
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
View(d_official)
(1649-1375)/1375
View(data_rate)
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
View(d_official)
View(data_abs)
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
View(data_total)
View(data_total)
View(data_total_official)
View(data_total)
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
data_abs <- data_total %>% select(date, Recovered, Hospitalized, Deceased)
data_abs_official <- data_total_official %>% select(date, Recovered, Hospitalized, Deceased)
data_abs <- data_total %>% select(date, Total)
data_abs_official <- data_total_official %>% select(date,Total)
data_abs <- data_total %>% select(date, Total) %>% mutate(source = "Crowd")
data_abs_official <- data_total_official %>% select(date,Total)  %>% mutate(source = "Official")
data_abs <- rbind(data_abs, data_abs_official) %>%
pivot_longer(-c(date), values_to = "total", names_to = "status") %>%
group_by(status) %>% mutate(max_cases = max(total)) %>% ungroup() %>%
mutate(label = paste(status, max_cases, sep=" | ") )
data_abs <- data_total %>% select(date, Total) %>% mutate(source = "Crowd")
data_abs_official <- data_total_official %>% select(date,Total)  %>% mutate(source = "Official")
View(data_abs)
View(data_abs_official)
data_abs <- rbind(data_abs, data_abs_official)
View(data_abs)
View(data_abs)
data_abs <- rbind(data_abs, data_abs_official) %>%
mutate(max_cases = max(Total)) %>% ungroup() %>%
mutate(label = paste(Source, max_cases, sep=" | ") )
data_abs <- rbind(data_abs, data_abs_official) %>%
mutate(max_cases = max(Total)) %>% ungroup() %>%
mutate(label = paste(source, max_cases, sep=" | ") )
View(data_abs)
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
data_abs <- data_total %>% mutate(source = "Crowd", total = Total)  %>% select(date, source, total)
data_abs_official <- data_total_official %>% mutate(source = "Official", total = Total) %>% select(date, source, total)
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
data_abs <- data_total %>% mutate(source = "Crowd", total = Total)  %>% select(date, source, total)
data_abs_official <- data_total_official %>% mutate(source = "Official", total = Total) %>% select(date, source, total)
data_abs <- rbind(data_abs, data_abs_official) %>%
mutate(max_cases = max(Total)) %>% ungroup() %>%
mutate(label = paste(source, max_cases, se
data_abs <- rbind(data_abs, data_abs_official) %>%
mutate(max_cases = max(Total)) %>% ungroup() %>%
mutate(label = paste(source, max_cases, sep=" | ") )
data_label <- data_total %>% select
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
options(
gganimate.nframes = 40,
gganimate.fps=10
)
pal <- "magma"
pal2 <- "cividis"
rebuild_dataframe <- F
yesterday <- Sys.Date() -1
today <- Sys.Date()
if (rebuild_dataframe) {
# d <- read_csv("https://raw.githubusercontent.com/rahulnyk/COVID19_IndiaData/master/covid_19_india.csv")
url <- 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSc_2y5N0I67wDU38DjDh35IZSIS30rQf7_NYZhtYYGU1jJYT6_kDx4YpF-qw0LSlGsBYP8pqM_a1Pd/pub?output=csv'
d_official <- read_csv("https://raw.githubusercontent.com/rahulnyk/COVID19_IndiaData/master/IndiaOfficalData.csv")
d <- read_csv(url) %>% clean_names() %>%
select(-c("source_1", "source_2", "source_3", "backup_notes", "notes", "estimated_onset_date")) %>%
filter(! is.na(date_announced) ) %>%
mutate(date = dmy(date_announced)) %>%
select(date, detected_state, current_status) %>%
rename(state_ut = "detected_state", status = "current_status" ) %>%
arrange(date)
dt <- NULL
for (di in as.list( unique(d$date) )) {
print(date)
dts <- d %>%
filter(date <= di) %>% group_by(state_ut, status) %>%
summarize(total = n() ) %>% mutate(date = di)
dt <- rbind(dt, dts)
}
}
data_total <- dt %>% group_by(date, status) %>% summarize(total = sum(total)) %>%
pivot_wider(names_from = status, values_from = total, values_fill = list(total = 0)) %>%
mutate(Total = Hospitalized + Recovered + Deceased + Migrated) %>% ungroup() %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date), date_prev = lag(date) ) %>%
mutate(date_current_prev = as.integer(date - date_prev) , date_next_prev = as.integer(date_next - date_prev) ) %>%
filter(date > ymd('2020-03-03')	) %>%
mutate( rate1 = round((Total - total_prev)*100/(date_current_prev*total_prev) ), rate2 = round((total_next - total_prev)*100/((date_next_prev)*Total)) ) %>%
ungroup()
data_total_official <- d_official %>% mutate(date = mdy(date)) %>%
mutate( total_next = lead(Total, default = 0), total_prev = lag(Total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
mutate( rate1 = round((Total - total_prev)*100/(as.integer(date_current_prev)*total_prev) ), rate2 = round((total_next - total_prev)*100/(as.integer(date_next_prev)*Total)) ) %>%
ungroup() %>% filter(date > ymd('2020-03-03')	)
data_rate <- data_total %>% select(date, rate1, rate2) %>% mutate(source = "Crowd")
data_rate_official <- data_total_official %>% select(date, rate1, rate2) %>% mutate(source = "Official")
data_rate <- rbind(data_rate, data_rate_official)
data_abs <- data_total %>% mutate(source = "Crowd", total = Total)  %>% select(date, source, total)
data_abs_official <- data_total_official %>% mutate(source = "Official", total = Total) %>% select(date, source, total)
data_abs <- rbind(data_abs, data_abs_official) %>%
mutate(max_cases = max(Total)) %>% ungroup() %>%
mutate(label = paste(source, max_cases, sep=" | ") )
data_label <- data_total %>% select(date, Total) %>% rename(total = "Total")
plot_theme <-   theme(
axis.text=element_text(size=8, color = "darkgrey"),
axis.title=element_text(size=10),
plot.title = element_text(size = 12, hjust = 0),
panel.grid.minor = element_blank(),
panel.grid.major = element_blank(),
legend.position = 'off',
panel.background = element_rect(fill = "white")
)
p1 <- ggplot(data = data_rate,  aes(x = date, y = rate1, group = source, color = source, fill=source)) + plot_theme +
geom_smooth(alpha = 0.2) +
geom_point(alpha = 0.3, size = 3) + geom_line(linetype = '12', alpha = 0.6)
p1 <- p1 + labs(y = "Growth rate in Percentage")  +
ylim(c(-10, 50)) +
scale_fill_viridis_d(option=pal, begin = 0, end = 0.9) +
scale_color_viridis_d(option=pal, begin = 0, end = 0.9) +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()) +
geom_label( color = "darkgrey", fill="white",
x=dmy('04-03-2020'),
y=40, alpha=0.5, hjust=0,
label= paste("Yesterdays Rate = ", round( tail(data_total$rate1, n=2)[1] ), "%", set="")
) +
scale_fill_viridis_d(option=pal2, begin = 0.1, end = 0.8) +
scale_color_viridis_d(option=pal2, begin = 0.1, end = 0.8)
p3 <- ggplot(data = data_abs, aes(x = date, y = total)) + plot_theme +
geom_bar(aes( fill = label ), position = "dodge", stat = "identity") +
geom_text(data = data_label, aes(label = total), hjust = -0.2, vjust = 0, size=4, angle=90) +
# scale_y_continuous(trans = 'log2') +
labs(y = "Cumulative number of cases") + # labs(title = "Reported number of cases by date") +
scale_fill_viridis_d(option=pal, begin = 0.2, end = 0.9) +
scale_color_viridis_d(option=pal, begin = 0.2, end = 0.9) +
theme(legend.position = c(0.2, 0.6), legend.title = element_blank()) + ylim(c(0, max(data_label$total)+200 ))
p <- ggarrange(
p1, p3,
ncol = 1,
nrow = 2
)
ggsave("gr_output.jpeg", p, device = "jpeg", dpi = 150, width = 4, height = 5)
print(p)
View(data_abs)
View(data_abs)
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
data_total <- dt %>% group_by(date, status) %>% summarize(total = sum(total)) %>%
pivot_wider(names_from = status, values_from = total, values_fill = list(total = 0)) %>%
mutate(total = Hospitalized + Recovered + Deceased + Migrated) %>% ungroup() %>%
mutate( total_next = lead(total, default = 0), total_prev = lag(total, default = 0)) %>%
mutate( date_next = lead(date), date_prev = lag(date) ) %>%
mutate(date_current_prev = as.integer(date - date_prev) , date_next_prev = as.integer(date_next - date_prev) ) %>%
filter(date > ymd('2020-03-03')	) %>%
mutate( rate1 = round((total - total_prev)*100/(date_current_prev*total_prev) ), rate2 = round((total_next - total_prev)*100/((date_next_prev)*total)) ) %>%
ungroup()
data_total_official <- d_official %>% mutate(date = mdy(date)) %>%
mutate( total_next = lead(total, default = 0), total_prev = lag(total, default = 0)) %>%
mutate( date_next = lead(date, order_by = date), date_prev = lag(date, order_by = date) ) %>%
mutate(date_current_prev = difftime(date, date_prev, units = "days") , date_next_prev = difftime(date_next, date_prev, units = "days") ) %>%
mutate( rate1 = round((total - total_prev)*100/(as.integer(date_current_prev)*total_prev) ), rate2 = round((total_next - total_prev)*100/(as.integer(date_next_prev)*total)) ) %>%
ungroup() %>% filter(date > ymd('2020-03-03')	)
View(data_total_official)
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
View(data)
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaGrowthRate_comparison.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
View(data_total)
View(data_state)
data <- rbind(data_state, data_total) %>%
mutate(day = as.integer(strftime(date, format = "%j")) ) %>%
###
group_by(state_ut) %>%
mutate( days_since_0 = day - min(day)  ) %>%
mutate( max_days = max(days_since_0) ) %>%
ungroup() %>%
###
filter(cumulative > 2) %>%
mutate(label =  paste(cumulative, state_ut, sep=" | "))
View(data)
labels <- data %>%
filter(date == yesterday) %>%
arrange( cumulative ) %>%
mutate(yend = (y_max/n())*row_number()) %>%
select(state_ut, yend)
View(labels)
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
labels <- data %>%
filter(date == yesterday)
labels <- data
data <- rbind(data_state, data_total) %>%
mutate(day = as.integer(strftime(date, format = "%j")) ) %>%
###
group_by(state_ut) %>%
mutate( days_since_0 = day - min(day)  ) %>%
mutate( max_days = max(days_since_0) ) %>%
ungroup() %>%
###
filter(cumulative > 2) %>%
mutate(label =  paste(cumulative, state_ut, sep=" | "))
labels <- data %>%
filter(date == yesterday) %>%
arrange( cumulative ) %>%
mutate(yend = (y_max/n())*row_number()) %>%
select(state_ut, yend)
labels <- data %>%
filter(date == yesterday) %>%
arrange( cumulative ) %>%
mutate(yend = (y_max/n())*row_number()) %>%
select(state_ut, yend)
labels <- data
View(labels)
labels <- data %>%
filter(date == ymd(yesterday))
yesterday
d <- data %>% filter(date == yesterday)
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
unique(d$Date)
unique(data$date)
data_state <- d %>%
rename(state_ut = "State/UnionTerritory", sn = "Sno", Date = "Date") %>%
mutate(date = dmy(Date)) %>%
###
group_by(state_ut, date) %>%
## Chosing the max number in case there are multiple entries for same date.
summarize(
ConfirmedIndianNational = max(ConfirmedIndianNational),
ConfirmedForeignNational = max(ConfirmedForeignNational),
Cured = max(Cured),
Deaths = max(Deaths)
) %>%
mutate(cumulative = ConfirmedIndianNational + ConfirmedForeignNational) %>%
filter(cumulative != 0) %>%
select(state_ut, date, cumulative) %>% ungroup()
data_total <- data_state %>% group_by(date) %>% summarize(cumulative = sum(cumulative)) %>%
mutate(state_ut = "India Total") %>% ungroup()
unique(data$date)
data_state <- d %>%
rename(state_ut = "State/UnionTerritory", sn = "Sno", Date = "Date") %>%
mutate(date = dmy(Date)) %>%
###
group_by(state_ut, date) %>%
## Chosing the max number in case there are multiple entries for same date.
summarize(
ConfirmedIndianNational = max(ConfirmedIndianNational),
ConfirmedForeignNational = max(ConfirmedForeignNational),
Cured = max(Cured),
Deaths = max(Deaths)
) %>%
mutate(cumulative = ConfirmedIndianNational + ConfirmedForeignNational) %>%
filter(cumulative != 0) %>%
select(state_ut, date, cumulative) %>% ungroup()
data_total <- data_state %>% group_by(date) %>% summarize(cumulative = sum(cumulative)) %>%
mutate(state_ut = "India Total") %>% ungroup()
data <- rbind(data_state, data_total) %>%
mutate(day = as.integer(strftime(date, format = "%j")) ) %>%
###
group_by(state_ut) %>%
mutate( days_since_0 = day - min(day)  ) %>%
mutate( max_days = max(days_since_0) ) %>%
ungroup() %>%
###
filter(cumulative > 2) %>%
mutate(label =  paste(cumulative, state_ut, sep=" | "))
unique(data$date)
View(data)
max(data$date)
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
View(d)
max(d$Date)
data_state <- d %>%
rename(state_ut = "State/UnionTerritory", sn = "Sno", Date = "Date") %>%
mutate(date = dmy(Date)) %>%
###
group_by(state_ut, date) %>%
## Chosing the max number in case there are multiple entries for same date.
summarize(
ConfirmedIndianNational = max(ConfirmedIndianNational),
ConfirmedForeignNational = max(ConfirmedForeignNational),
Cured = max(Cured),
Deaths = max(Deaths)
) %>%
mutate(cumulative = ConfirmedIndianNational + ConfirmedForeignNational) %>%
filter(cumulative != 0) %>%
select(state_ut, date, cumulative) %>% ungroup()
max(data_state$date)
data_state <- d %>%
rename(state_ut = "State/UnionTerritory", sn = "Sno", Date = "Date") %>%
mutate(date = dmy(Date))
max(data_state$date)
data_state <- d %>%
rename(state_ut = "State/UnionTerritory", sn = "Sno", Date = "Date") %>%
mutate(date = dmy(Date)) %>%
###
group_by(state_ut, date) %>%
## Chosing the max number in case there are multiple entries for same date.
summarize(
ConfirmedIndianNational = max(ConfirmedIndianNational),
ConfirmedForeignNational = max(ConfirmedForeignNational),
Cured = max(Cured),
Deaths = max(Deaths)
) %>%
mutate(cumulative = ConfirmedIndianNational + ConfirmedForeignNational) %>%
# filter(cumulative != 0) %>%
select(state_ut, date, cumulative) %>% ungroup()
max(data_state$date)
data_state <- d %>%
rename(state_ut = "State/UnionTerritory", sn = "Sno", Date = "Date") %>%
mutate(date = dmy(Date)) %>%
###
group_by(state_ut, date) %>%
## Chosing the max number in case there are multiple entries for same date.
summarize(
ConfirmedIndianNational = max(ConfirmedIndianNational),
ConfirmedForeignNational = max(ConfirmedForeignNational),
Cured = max(Cured),
Deaths = max(Deaths)
) %>%
mutate(cumulative = ConfirmedIndianNational + ConfirmedForeignNational) %>%
filter(cumulative != 0) %>%
select(state_ut, date, cumulative) %>% ungroup()
View(data_state)
data_state <- d %>%
rename(state_ut = "State/UnionTerritory", sn = "Sno", Date = "Date") %>%
mutate(date = dmy(Date)) %>%
###
group_by(state_ut, date) %>%
## Chosing the max number in case there are multiple entries for same date.
summarize(
ConfirmedIndianNational = max(ConfirmedIndianNational),
ConfirmedForeignNational = max(ConfirmedForeignNational),
Cured = max(Cured),
Deaths = max(Deaths)
)
View(data_state)
?max
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
View(labels)
View(data_total)
View(data_state)
View(labels)
View(data)
View(data)
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
source('~/work/covid19/COVID19_IndiaData/IndiaTimeseries.R')
